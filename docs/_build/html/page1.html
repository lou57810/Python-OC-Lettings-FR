<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amélioration de l’architecture modulaire. &mdash; Documentation Python-OC-Lettings-FR 1.0.0</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=05dadb3a"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/translations.js?v=bf059b8c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Résolution des problemes du projet." href="page2.html" />
    <link rel="prev" title="Welcome to Python-OC-Lettings-FR’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Python-OC-Lettings-FR
              <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Amélioration de l’architecture modulaire.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fork-et-clone-de-l-application">Fork et clone de l’application.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lancement-et-test-de-l-application-en-local">Lancement et test de l’application en local.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consulter-les-ressources-modification-des-fichiers-de-migration">Consulter les ressources, modification des fichiers de migration.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page2.html">Résolution des problemes du projet.</a></li>
<li class="toctree-l1"><a class="reference internal" href="page3.html">Surveillance de l’application et des erreurs avec Sentry.</a></li>
<li class="toctree-l1"><a class="reference internal" href="page4.html">Mise en place du déploiement avec Docker, et le pipleline Cicd:</a></li>
<li class="toctree-l1"><a class="reference internal" href="page5.html">Documentation de l’application.</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python-OC-Lettings-FR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Amélioration de l’architecture modulaire.</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/page1.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="amelioration-de-l-architecture-modulaire">
<h1>Amélioration de l’architecture modulaire.<a class="headerlink" href="#amelioration-de-l-architecture-modulaire" title="Lien vers cette rubrique"></a></h1>
<section id="fork-et-clone-de-l-application">
<h2>Fork et clone de l’application.<a class="headerlink" href="#fork-et-clone-de-l-application" title="Lien vers cette rubrique"></a></h2>
<p>Fork du projet pour créer un projet identique sur notre compte GitHub (Clic sur Fork et le nom du projet).
Clone du projet forké sur notre ordinateur local pour isoler notre travail.
Pour récupèrer la copie en local, clic sur Clone, puis copie de l’url du projet, et en console:
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">copie</span> <span class="pre">de</span> <span class="pre">l'url</span> <span class="pre">du</span> <span class="pre">projet</span></code>
La commande <code class="docutils literal notranslate"><span class="pre">ls</span></code> affiche le nom du repositrory cloné sur notre poste de travail.</p>
</section>
<section id="lancement-et-test-de-l-application-en-local">
<h2>Lancement et test de l’application en local.<a class="headerlink" href="#lancement-et-test-de-l-application-en-local" title="Lien vers cette rubrique"></a></h2>
<p>En utilisant Git bash:
Tout d’abord nous créeons un environnement virtuel avec la commande:
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">venv</span></code>
Puis on se place dans cet environnement avec la commande:
<code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">venv/Scripts/activate</span></code>
Et nous pouvons alord démarrer l’application avec la commande django:
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></code>
Renvoi de l’erreur: ModuleNotFoundError: No module named “distutils”</p>
<p>Donc essai mise à jour pip et Django.
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></code>
Nouvelle erreur:</p>
<blockquote>
<div><p>HINT: Configure the DEFAULT_AUTO_FIELD setting or the OCLettingsSiteConfig.default_auto_field attribute</p>
</div></blockquote>
<p>to point to a subclass of AutoField, e.g. “django.db.models.BigAutoField”.
Correction:
Ajout « DEFAULT_AUTO_FIELD = “django.db.models.AutoField” » dans settings.py
Explications:
Type de champ clé primaire à utiliser par défaut pour les modèles n’ayant pas de champ avec primary_key=True.</p>
<p>La valeur de DEFAULT_AUTO_FIELD sera respectée lors de la création de nouvelles tables intermédiaires
créées automatiquement pour les relations plusieurs-à-plusieurs.
Malheureusement, les clés primaires des tables intermédiaires existantes créées automatiquement
ne peuvent actuellement pas être mises à jour par le système des migrations.
Cela signifie que si vous modifiez la valeur de DEFAULT_AUTO_FIELD,
puis que vous générez des migrations, les clés primaires des modèles liés seront mises à jour,
comme pour les clés étrangères des tables intermédiaires,
mais la clé primaire de ces tables intermédiaires ne seront pas migrées.
Pour corriger cela, vous devez ajouter une opération RunSQL à vos migrations pour effectuer l’étape ALTER TABLE requise.
Vous pouvez obtenir le nom de la table existante au moyen de sqlmigrate, dbshell,
ou avec la propriété remote_field.through._meta.db_table du champ.
Les modèles intermédiaires définis explicitement sont déjà pris en charge par le système des migrations.
La migration automatique des clés primaires des tables intermédiaires existantes créées automatiquement
pourrait être implémentée à une date ultérieure.</p>
<p>Faisons une migration: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span></code>, et relançons:
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></code> , puis en renseignant <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8000</span></code> dans le navigateur le site
semble alors fonctionner, mais nous pouvons optimiser ce projet.</p>
</section>
<section id="consulter-les-ressources-modification-des-fichiers-de-migration">
<h2>Consulter les ressources, modification des fichiers de migration.<a class="headerlink" href="#consulter-les-ressources-modification-des-fichiers-de-migration" title="Lien vers cette rubrique"></a></h2>
<p>Nous allons modifier le projet, pour qu’il corresponde à une architecture MVT (Model View Template).
A cet effet, nous allons créer ou modifier 3 dossiers séparés:
- oc_lettings_site
- lettings
- profiles</p>
<p>Création des apps lettings et profiles:
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">lettings</span></code>
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">startapp</span> <span class="pre">profiles</span></code></p>
<p>Création de nouvelles tables.
Ceci implique la modifications des fichiers models.py , views.py de chaque application,
en les réaffectant de leurs classes respectives, le tout suivi d’une migration.
Nous devons également ajouter ces applications dans oc_lettings_site/settings.py
A ce stade la base de donnée est modifiée, et pour remedier au problème du changement de nom des modules,
nous devons créer un utilitaire de transition pour réaffecter ces changements dans la base de donnée:
<code class="docutils literal notranslate"><span class="pre">tables_update.py</span></code>
Cet utilitaire a pour but de migrer les datas de :
oc_lettings_site_address vers lettings_address
oc_lettings_site_letting vers lettings_letting
oc_lettings_site_profile vers profiles_profile
Nous pouvons alors supprimer models.py et modifier views.py de l’application oc_letting_site.
Il sera également nécéssaire de redistribuer le dossier templates dans dans leurs applications respectives.</p>
<p>On s’apercoit que le lancement de l’application fonctionne maintenant, mais les liens, ne réagissent plus,
depuis la page d’acceuil.
Il nous faut donc modifier les urls dans chaque application.
Crééons lettings/urls.py et profiles/urls.py et redistribuons les rôles des chemins(Path) depuis oc_lettings_site/urls.</p>
<p>Il nous faut maintenant modifier la base de données pour que les classes nouvellement crées:
- address
- profile
- letting
soient échangées dans cette base:
le fichier précédemment créé va nous permettre de faire cette transition.
Il sera nécéssaire d’ajouter la bib pandas avec pip.
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">tables_updates.py</span></code>
En relancant <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></code> nous pouvons accèder à l’ingégralité du site.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Python-OC-Lettings-FR’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="page2.html" class="btn btn-neutral float-right" title="Résolution des problemes du projet." accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2024, Ben_Oc.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>